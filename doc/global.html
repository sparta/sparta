<HTML>
<CENTER><A HREF = "http://sparta.sandia.gov">SPARTA WWW Site</A> - <A HREF = "Manual.html">SPARTA Documentation</A> - <A HREF = "Section_commands.html#comm">SPARTA Commands</A> 
</CENTER>






<HR>

<H3>global command 
</H3>
<P><B>Syntax:</B>
</P>
<PRE>global keyword values ... 
</PRE>
<UL><LI>one or more keyword/value pairs 

<LI>keyword = <I>fnum</I> or <I>nrho</I> or <I>vstream</I> or <I>temp</I> or <I>gravity</I> or <I>surfmax</I> or <I>gridcut</I> or <I>comm/sort</I> or <I>comm/style</I> or <I>weight</I> 

<PRE>  <I>fnum</I> value = ratio
    ratio = Fnum ratio of physical particles to simulation particles
  <I>nrho</I> value = density
    density = number density of background gas (# per length^3 units)
  <I>vstream</I> values = Vx Vy Vz
    Vx,Vy,Vz = streaming velocity of background gas (velocity units)
  <I>temp</I> values = thermal
    thermal = temperature of background gas (temperature units)
  <I>gravity</I> values = mag ex ey ez
    mag = magnitude of acceleration due to gravity (acceleration units)
    ex,ey,ez = direction vector that gravity acts in
  <I>surfmax</I> value = Nsurf
    Nsurf = max # of surface elements allowed in single grid cell
  <I>gridcut</I> value = cutoff
    cutoff = acquire ghost cells up to this far away (distance units)
  <I>comm/sort</I> value = yes or no
    yes/no = sort incoming messages by proc ID if yes, else no sort
  <I>comm/style</I> value = neigh or all
    neigh = setup particle comm with subset of near-neighbor processor
    all = allow particle comm with potentially any processor
  <I>weight</I> value = <I>wstyle</I> <I>mode</I>
    wstyle = <I>grid</I>
    mode = <I>none</I> or <I>volume</I> or <I>radius</I> 
</PRE>

</UL>
<P><B>Examples:</B>
</P>
<PRE>global fnum 1.0e20
global vstream 100.0 0 0 fnum 5.0e18
global temp 1000
global weight cell radius 
</PRE>
<P><B>Description:</B>
</P>
<P>Define global properties of the system.
</P>
<P>The <I>fnum</I> keyword sets the ratio of real, physical molecules to
simulation particles.  E.g. a value of 1.0e20 means that one particle
in the simulation represents 1.0e20 molecules of the particle species.
</P>
<P>The <I>nrho</I> keyword sets the number density of the background gas.  For
3d simulations the units are #/volume.  For 2d, the units are
effectively #/area since the z dimension is treated as having a length
of 1.0.
</P>
<P>Assuming your simulation is populated by particles from the background
gas, the <I>fnum</I> and <I>nrho</I> settings can determine how many particles
will be present in your simulation, when using the
<A HREF = "create_particles.html">create_particles</A> or <A HREF = "fix_inflow.html">fix
inflow</A> commands.
</P>
<P>The <I>vstream</I> keyword sets the streaming velocity of the background
gas.
</P>
<P>The <I>temp</I> keyword sets the thermal temperature of the background gas.
This is a Gaussian velocity distribution superposed on top of the
streaming velocity.
</P>
<P>The <I>gravity</I> keyword sets an acceleration term which is included in
the motion of particles.  The magnitude of gravity is set by the <I>mag</I>
keyword.  Its direction of action is set as (ex,ex,ez).  The direction
does not have to be a unit vector.  If the magnitude is set to 0.0, no
acceleration term is included, which is the default.
</P>
<P>The <I>surfmax</I> keyword determines the maximum number of surface
elements (lines in 2d, triangles in 3d) that can overlap a single grid
cell.  The default is 100, which should be large enough for any
simulation, unless you define very coarse grid cells (relative to the
size of surface elements).
</P>
<P>The <I>gridcut</I> keyword determines the cutoff distance at which ghost
grid cells will be stored by each processor.  Assuming the processor
owns a compact clump of grid cells, it will also store ghost cell
information from nearby grid cells, up to this distance away.  If the
setting is < 0.0 (the default) then each processor owns a copy of
ghost cells for all grid cells in the simulation.  This can require
too much memory for large models.  If the cutoff is 0.0, processors
own a minimal number of ghost cells. This saves memory but may require
multiple cutoff is too short, multiple passes of communication may be
required each timestep to move all the particles and migrate them to
new owning processors.  Typically a cutoff the size of 2-3 grid cell
diameters is a good balance that requires only modest memory to store
ghost cells and allows all particle moves to complete in only one pass
of communication.
</P>
<P>The <I>comm/sort</I> keyword determines whether the messages a proc
receives for migrating particles (every step) and ghost grid cells (at
setup and after re-balance) are sorted by processor ID.  Doing this
requires a bit of overhead, but can make it easier to debug in
parallel, because simulations should be reproducible when run on the
same number of processors.  Without sorting, messages may arrive in a
randomized order, which means lists of particles and grid cells end up
in a different order leading to statistical differences between runs.
</P>
<P>The <I>comm/style</I> keyword determines the style of particle
communication that is performed to migrate particles every step.  The
most efficient method is typically for each processor to exchange
messages with only the processors it has ghost cells for, which is the
method used by the <I>neigh</I> setting.  The <I>all</I> setting performs a
relatively cheap, but global communication operation to determine the
exact set of neighbors that need to be communicated with at each step.
For small processor counts there is typically little difference.  On
large processor counts the <I>neigh</I> setting can be significantly
faster.  However, if the flow is streaming in one dominant direction,
there may be no particle migration needed to upwind processors, so the
<I>all</I> method can generate smaller counts of neighboring processors.
</P>
<P>Note that the <I>neigh</I> style only has an effect (at run time) when the
grid is decomposed by the RCB option of the <A HREF = "balance.html">balance</A> or
<A HREF = "fix_balance.html">fix balance</A> commands.  If that is not the case,
SPARTA performs the particle communication as if the <I>all</I> setting
were in place.
</P>
<P>The <I>weight</I> keyword determines whether particle weighting is used.
Currently the only style allowed, as specified by wstyle = <I>grid</I>, is
grid-based weighting.  This is a mechanism for inducing every grid
cell to contain roughly the same number of particles (even if cells
are of varying size), so as to minimize the total number of particles
used in a simulation while preserving accurate time and spatial
averages of flow quantities.
</P>
<P>If grid-based particle weighting is enabled, two computations occur.
First, each grid cell stores a "weight" which is pre-computed based
either on the cell <I>volume</I> or <I>radius</I>, as specified by the <I>mode</I>
setting.  The <I>radius</I> setting is only allowed for axisymmetric
systems; see <A HREF = "Section_howto.html#howto_2">Section 4.2</A> for details.
The radius in this case is the distance the cell's midpoint is from
the axis of symmetry.
</P>
<P>Second, when a particle moves from an initial cell to a final cell,
the initial/final ratio of the two cell weights is calculated.  If the
ratio > 1, then additional particles may be created in the final cell,
by cloning the attributes of the incoming particle.  E.g. if the ratio
= 3.4, then two extra particle are created, and a 3rd is created with
probability 0.4.  If the ratio < 1, then the incoming particle may be
deleted.  E.g. if the ratio is 0.7, then the incoming particle is
deleted with probability 0.3.
</P>
<P><B>Restrictions:</B>
</P>
<P>The global surfmax command must be used before surface elements are
defined, e.g. via the <A HREF = "read_surf.html">read_surf</A> command.
</P>
<P>The global gridcut command with a cutoff >= 0.0 will only be active if
the grid cells owned by each processor are "clumped" by the time a
simulation is performed.  This will be the case if the RCB option of
the <A HREF = "balance_grid.html">balance_grid</A> or <A HREF = "fix_balance.html">fix balance</A>
command is used.  If they are not clumped, a cutoff setting >= 0.0
will generate an error.
</P>
<P><B>Related commands:</B>
</P>
<P><A HREF = "mixture.html">mixture</A>
</P>
<P><B>Default:</B>
</P>
<P>The keyword defaults are fnum = 1.0, nrho = 1.0, vstream = 0.0 0.0
0.0, temp = 273.15, gravity = 0.0 0.0 0.0 0.0, surfmax = 100, gridcut
= -1.0, comm/sort = no, comm/style = neigh.
</P>
</HTML>
